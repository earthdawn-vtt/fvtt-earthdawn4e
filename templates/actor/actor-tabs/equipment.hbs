<section class="tab {{tabs.equipment.cssClass}}" data-group="sheet" data-tab="equipment" data-editable="{{@root.editable}}">
<h2>{{localize "ED.Actor.Header.equipment"}}</h2>

<div class="container__block">
    {{#if (eq this.actor.type "character")}}
        <div class="encumbrance__container">
            <div class="encumbrance__row">
                <span class="encumbrance__label">{{localize "ED.Actor.Header.encumbrance"}}:</span>
                <input id="encumbrance__value" class="input__rectangle-input--centered"
                    type="number"
                    value="{{actor.system.encumbrance.value}}"
                    min="0" step="1"
                    oninput="
                        const c = this.closest('.encumbrance__container');
                        const fill = c.querySelector('.encumbrance__fill');
                        const max  = parseFloat(c.querySelector('#encumbrance__max').value);
                        const val  = parseFloat(this.value);
                        const rangeMax = max * 2;
                        const percent = (val / rangeMax) * 100;
                        fill.style.setProperty('--fill-width', percent + '%');
                        fill.classList.remove('low','medium','high','over');
                        if (val <= max) fill.classList.add('low');
                        else if (val <= max * 1.5) fill.classList.add('medium');
                        else if (val <= rangeMax) fill.classList.add('high');
                        else fill.classList.add('over');
                    ">
                <span>/</span>
                <input id="encumbrance__max" class="input__rectangle-input--centered"
                    type="number"
                    value="{{actor.system.encumbrance.max}}"
                    min="1" step="1"
                    oninput="
                        // Recompute the fill when max changes
                        this.closest('.encumbrance__container')
                            .querySelector('#encumbrance__value')
                            .dispatchEvent(new Event('input'));
                    ">
                    <div class="encumbrance__bar">
                    <div class="encumbrance__fill"></div>
                    <div class="encumbrance__marker marker__x"></div>
                    <div class="encumbrance__marker marker__x15"></div>
                </div>
            </div>
        </div>
    {{/if}}

  {{!-- Weapons --}}
    <div class="container__section">
        <div class="equipment-card__grid--container container__header text-break__auto">
            <div class="equipment-card__grid--item"></div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.weapons"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.damage"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.range"}}</div>
            {{#if (eq system.weaponType "thrown")}}
                <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.ammunition"}}</div>
            {{else}}
                <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.amount"}}</div>
            {{/if}}
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.equippedStatus"}}</div>
            <div class="equipment-card__grid--item"></div>
        </div>
        {{#each actor.itemTypes.weapon}}
            {{> "systems/ed4e/templates/actor/cards/equipment-card.hbs"}}
        {{/each}}
    </div>

  {{!-- Armor --}}
    <div class="container__section">
        <div class="equipment-card__grid--container container__header text-break__auto">
            <div class="equipment-card__grid--item"></div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.armor"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.physicalArmor"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.mysticalArmor"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.initiativePenalty"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.equippedStatus"}}</div>
            <div class="equipment-card__grid--item"></div>
        </div>
        {{#each actor.itemTypes.armor}}
            {{> "systems/ed4e/templates/actor/cards/equipment-card.hbs"}}
        {{/each}}
  </div>

  {{!-- Shields --}}
    <div class="container__section">
        <div class="equipment-card__grid--container container__header text-break__auto">
            <div class="equipment-card__grid--item"></div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.shields"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.physicalDefense"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.mysticalDefense"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.initiativePenalty"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.equippedStatus"}}</div>
            <div class="equipment-card__grid--item"></div>
        </div>
        {{#each actor.itemTypes.shield}}
           {{> "systems/ed4e/templates/actor/cards/equipment-card.hbs"}}
        {{/each}}
    </div>

  {{!-- Equipment --}}  
    <div class="container__section">
        <div class="equipment-card__grid--container container__header text-break__auto">
            <div class="equipment-card__grid--item"></div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.equipment"}}</div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.amount"}}</div>
            <div class="equipment-card__grid--item"></div>
            <div class="equipment-card__grid--item"></div>
            <div class="equipment-card__grid--item">{{localize "ED.Actor.Header.equippedStatus"}}</div>
            <div class="equipment-card__grid--item"></div>
        </div>
        {{#each actor.itemTypes.equipment}}
            {{> "systems/ed4e/templates/actor/cards/equipment-card.hbs"}}
        {{/each}}
    </div>
</div>

</section>