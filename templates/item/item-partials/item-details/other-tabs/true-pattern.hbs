<section class="tab {{tabs.true-pattern.cssClass}} scrollable" data-group="sheet" data-tab="true-pattern">
  {{#if showTruePattern}}

  <!-- Button controls -->
  <div class="item-controls flexrow">
    <button data-action="weaveNewThread" data-tooltip="{{localize "ED.ToolTips.threadItemWeaveNewThread"}}">
      <i class="fas {{config.icons.add}}" inert></i>
      <span>{{localize "ED.Item.PhysicalItems.createThreadItemThread"}}</span>
    </button>
    {{#if editable}}
    <button data-action="deleteTruePattern" data-tooltip="{{localize "ED.ToolTips.threadItemDeleteTruePattern"}}">
      <i class="fas {{config.icons.delete}}" inert></i>
      <span>{{localize "ED.Item.PhysicalItems.deleteTruePattern"}}</span>
    </button>
    {{/if}}
  </div>
  {{#if editable}}
  <div class="item-controls flexrow">
    <button data-action="addThreadItemLevel" data-tooltip="{{localize "ED.ToolTips.addThreadItemLevel"}}">
      <i class="fas {{config.icons.add}}" inert></i>
      <span>{{localize "ED.Item.PhysicalItems.addThreadItemLevel"}}</span>
    </button>
    <button data-action="deleteThreadItemLevel" data-tooltip="{{localize "ED.ToolTips.deleteThreadItemLevel"}}">
      <i class="fas {{config.icons.delete}}" inert></i>
      <span>{{localize "ED.Item.PhysicalItems.deleteThreadItemLevel"}}</span>
    </button>
  </div>
  {{/if}}

  <!-- basic information -->
  <fieldset>
    <legend>{{localize "ED.Item.PhysicalItems.truePatternBaseInformation"}}</legend>
    {{formGroup systemFields.truePattern.fields.maxThreads value=item.system.truePattern.maxThreads disabled=(not editable)}}
    {{formGroup systemFields.truePattern.fields.mysticalDefense value=item.system.truePattern.mysticalDefense disabled=(not editable)}}
    {{formGroup systemFields.truePattern.fields.tier value=item.system.truePattern.tier disabled=(not editable)}}
    {{formGroup systemFields.truePattern.fields.attachedThreads value=item.system.truePattern.attachedThreads disabled=(not editable)}}
    {{formGroup systemFields.truePattern.fields.knownToPlayer value=item.system.truePattern.knownToPlayer disabled=(not editable)}}

  </fieldset>

  <!--thread item levels-->
  {{#each item.system.truePattern.threadItemLevels}}
    <!--    This needs to be included because otherwise the level value won't be submitted with the form and the field will be initialized to default 1 for some reason :rolling_eyes:-->
    <!--input type="hidden" name="system.truePattern.threadItemLevels.{{@key}}.level" value="{{this.level}}"-->

    {{#if this.isVisible}}
    <fieldset>
      <legend>{{localize "ED.Item.PhysicalItems.threadItemLevelHeader" level=this.level}}</legend>

      {{#if @root/isGM}}
      {{formGroup this.schema.fields.knownToPlayer name=(concat "system.truePattern.threadItemLevels." @key ".knownToPlayer") value=this.knownToPlayer disabled=(not @root/editable)}}
      {{/if}}
      <fieldset>
        <legend>{{localize this.schema.fields.keyKnowledge.label}}</legend>
        {{formGroup this.schema.fields.keyKnowledge.fields.question name=(concat "system.truePattern.threadItemLevels." @key ".keyKnowledge.question") value=this.keyKnowledge.question disabled=(not @root/editable)}}
        {{#if (or this.keyKnowledge.isKnown @root/isGM)}}
          {{formGroup this.schema.fields.keyKnowledge.fields.answer name=(concat "system.truePattern.threadItemLevels." @key ".keyKnowledge.answer") value=this.keyKnowledge.answer disabled=(not @root/editable)}}
        {{/if}}
        {{#if @root/isGM}}
        {{formGroup this.schema.fields.keyKnowledge.fields.isKnown name=(concat "system.truePattern.threadItemLevels." @key ".keyKnowledge.isKnown") value=this.keyKnowledge.isKnown disabled=(not @root/editable)}}
        {{/if}}
      </fieldset>
      {{formGroup this.schema.fields.deed name=(concat "system.truePattern.threadItemLevels." @key ".deed") value=this.deed disabled=(not @root/editable)}}
      {{formGroup this.schema.fields.effect name=(concat "system.truePattern.threadItemLevels." @key ".effect") value=this.effect disabled=(not @root/editable)}}
      {{formGroup this.schema.fields.activeEffects name=(concat "system.truePattern.threadItemLevels." @key ".activeEffects") value=this.activeEffects disabled=(not @root/editable)}}
      {{formGroup this.schema.fields.abilities name=(concat "system.truePattern.threadItemLevels." @key ".abilities") value=this.abilities disabled=(not @root/editable)}}
    </fieldset>
    {{/if}}

  {{/each}}

{{else}}

  {{#if editable}}
  <button data-action="addTruePattern" aria-label="{{localize "ED.ToolTips.threadItemAddTruePattern"}}">
    <!--i class="fas {{config.icons.add}}" inert></i-->
    <span>{{localize "ED.Item.PhysicalItems.addTruePattern"}}</span>
  </button>
  {{/if}}

{{/if}}

</section>
